"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[288],{5288:(It,N,a)=>{a.r(N),a.d(N,{MassloaderotmModule:()=>Tt});var h=a(9808),v=a(4521),T=a(3075),i=a(8279),U=a(5226),C=a.n(U),x=a(6087),y=a(1301),b=a(9648),R=a(4004),P=a(262),J=a(2843),L=a(520),t=a(5e3),G=a(946);let F=(()=>{class o{constructor(e,n,s){this.globalService=n,this.config=s,this.apiBase="https://web.ldsp.com.co:8443/TspApi/api"}sendOrders(e){return this.globalService.post(this.apiBase+b.s.Endpoints.MASSLOAD.POST_ORDERS,e,{headers:new L.WM({"Content-Type":"application/json",responseType:""}),responseType:""}).pipe((0,R.U)(n=>n,n=>n),(0,P.K)(n=>(0,J._)(n)))}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(t.zs3),t.LFG(y.U),t.LFG(G.E))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var I=a(8966),H=a(2290),c=a(9224),M=a(4834),A=a(1095),D=a(7423),E=a(5899),S=a(4847);function z(o,r){1&o&&(t.TgZ(0,"div")(1,"ngx-dropzone-label"),t._uU(2,"Seleccione o arrastre su archivo CSV"),t.qZA()())}function Q(o,r){if(1&o&&(t.TgZ(0,"div")(1,"ngx-dropzone-label"),t._uU(2),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(e.file[0].name)}}function Y(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().onUpload()}),t.TgZ(2,"span",2),t._uU(3," upload "),t.qZA(),t._uU(4," Cargar "),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.precarga)}}function w(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"button",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClear()}),t.TgZ(2,"span",2),t._uU(3," cached "),t.qZA(),t._uU(4," Limpiar panel "),t.qZA()()}}function j(o,r){1&o&&t._UZ(0,"mat-progress-bar",23)}function B(o,r){if(1&o&&(t.TgZ(0,"th",27),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e)}}function W(o,r){if(1&o&&(t.TgZ(0,"td",28),t._uU(1),t.qZA()),2&o){const e=r.$implicit,n=t.oxw().$implicit;t.xp6(1),t.Oqu(e[n])}}function V(o,r){if(1&o&&(t.ynx(0,24),t.YNc(1,B,2,1,"th",25),t.YNc(2,W,2,1,"td",26),t.BQk()),2&o){const e=r.$implicit;t.Q6J("matColumnDef",e)("sticky","ORDER_RELEASE_GID"===e)}}function X(o,r){1&o&&t._UZ(0,"tr",29)}function $(o,r){1&o&&t._UZ(0,"tr",30)}function K(o,r){1&o&&(t.TgZ(0,"tr",31)(1,"td",32),t._uU(2,"No data matching the filter"),t.qZA()())}const k=function(){return[5,10,25,100]};function q(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",0)(1,"h2"),t._uU(2),t.qZA(),t.YNc(3,j,1,0,"mat-progress-bar",14),t.TgZ(4,"mat-card")(5,"mat-card-header")(6,"mat-card-title"),t._uU(7,"Verifique los datos"),t.qZA()(),t.TgZ(8,"mat-card-content",15)(9,"table",16,17),t.NdJ("matSortChange",function(s){return t.CHM(e),t.oxw().sortData(s)}),t.YNc(11,V,3,2,"ng-container",18),t.YNc(12,X,1,0,"tr",19),t.YNc(13,$,1,0,"tr",20),t.YNc(14,K,3,0,"tr",21),t.qZA()(),t._UZ(15,"mat-paginator",22),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(2),t.Oqu(e.label),t.xp6(1),t.Q6J("ngIf",e.progressbar),t.xp6(6),t.Q6J("dataSource",e.dataSource),t.xp6(2),t.Q6J("ngForOf",e.displayedColumns),t.xp6(1),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(2),t.Q6J("length",e.ELEMENT_DATA.length)("pageSize",10)("pageSizeOptions",t.DdM(9,k))}}function tt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"mat-card",33)(2,"div",34)(3,"strong"),t._uU(4,"Al confirmar el cargue, los registros ser\xe1n procesados"),t.qZA()(),t._UZ(5,"br"),t.TgZ(6,"div",34)(7,"button",35),t.NdJ("click",function(){return t.CHM(e),t.oxw().SendData()}),t.TgZ(8,"span",2),t._uU(9," check "),t.qZA(),t._uU(10," Confirmar cargue "),t.qZA()(),t.TgZ(11,"mat-card-footer",36)(12,"div",5),t._UZ(13,"div",9),t.TgZ(14,"div",9),t._uU(15),t.qZA(),t._UZ(16,"div",9),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(7),t.Q6J("disabled",!0===e.progressbar),t.xp6(8),t.hij(" Total pedidos en plano: ",e.ELEMENT_DATA.length," ")}}const et=[{path:"massload",component:(()=>{class o{constructor(e,n,s,d,l){this.massloadSerrvice=e,this.dialog=n,this.toastr=s,this.cdr=d,this.router=l,this.label="",this.precarga=!1,this.errores=[],this.ELEMENT_DATA=[],this.displayedColumns=[],this.dataSource=new i.by,this.control=new T.NI("",[T.kI.required]),this.progressbar=!1,this.file=[],this.isEditableNew=!0}ngOnInit(){}ngAfterViewInit(){this.cdr.detectChanges()}getHeader(){Object.keys(this.ELEMENT_DATA[0]).forEach(s=>{this.displayedColumns.push(s.toString())})}onUpload(){this.progressbar=!0,this.cdr.detectChanges();const e=this.file;if(e&&e.length){var s=e[0].name.split(".").pop().toLowerCase(),d=["csv"].indexOf(s)>-1;console.log(d);var l=this;if(d){const Ct=e[0],O=new FileReader;O.onload=function(xt){l.csvContent=xt.target.result;let Z=!1,m=[],g=[],_=0;for(const u of l.csvContent.split(/[\r\n]+/))if(Z){let p={};for(let f=0;f<_;f++)p[g[f]]=u.split(";")[f];m.push(p)}else{for(let p=0;p<u.split(";").length;p++)_=u.split(";").length,g.push(u.split(";")[p].trim().replace(/ /g,"_").replace("DEST_AGENCIA_CUMPLIDO","DESTINATION_AGENCIA_CUMPLIDO").replace("DEST_AGENCIA_DESPACHO","DESTINATION_AGENCIA_DESPACHO").replace("DEST_CODIGO_MUNICIPIO_RNDC","DESTINATION_CODIGO_MUNICIPIO_RNDC").replace("TRANSPORT_HANDLING_UNIT_ID","THU").replace("SHIP_UNIT_ID","SHIP_UNIT_GID"));Z=!0}l.ELEMENT_DATA=m,l.JSONData=l.convertToJson(m),l.displayedColumns=g,l.dataSource=new i.by(l.ELEMENT_DATA),l.dataSource.paginator=l.paginator,console.log({data:m,headers:g,data_str:l.JSONData}),l.cdr.detectChanges()},O.readAsText(Ct,"UTF-8")}else console.error("Invalid File Format!")}this.progressbar=!1,this.cdr.detectChanges()}convertToJson(e){var s=JSON.stringify(e).replace("DEST_AGENCIA_CUMPLIDO","DESTINATION_AGENCIA_CUMPLIDO").replace("DEST_AGENCIA_DESPACHO","DESTINATION_AGENCIA_DESPACHO").replace("DEST_CODIGO_MUNICIPIO_RNDC","DESTINATION_CODIGO_MUNICIPIO_RNDC").replace("TRANSPORT_HANDLING_UNIT_ID","THU").replace("SHIP_UNIT_ID","SHIP_UNIT_GID").replace(" ","+");return console.log(s),s}onClear(){this.ELEMENT_DATA.length=0,this.file.length=0,this.control.setValue(""),this.precarga=!1,this.cdr.detectChanges(),this.router.navigateByUrl("/",{skipLocationChange:!0}).then(()=>{this.router.navigate(["/tsp/massload"])})}onSelect(e){this.file.push(...e.addedFiles)}sortData(e){const n=this.dataSource.data.slice();""!==e.direction?(this.sortedData=n.sort((s,d)=>this.compare(s.active,d.active,"asc"===e.direction)),this.dataSource.data=this.sortedData,this.dataSource.paginator=this.paginator):this.sortedData=n}compare(e,n,s){return(e<n?-1:1)*(s?1:-1)}SendData(){this.ELEMENT_DATA.length>0&&this.massloadSerrvice.sendOrders(this.JSONData).subscribe({next:e=>{console.log(e),"FAILED"===e.STATUS?C().fire({title:"Ha ocurrido un error",text:e.ERROR_MSGS,icon:"error"}):C().fire({title:"Realizado",text:"Pedidos enviados con numero de transmisi\xf3n: "+e.TRANSMISSION_NO,icon:"success"})},error:e=>{console.log(e),C().fire({title:"Ha ocurrido un error",text:e.error.error,icon:"error"})},complete:()=>{this.onClear()}})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(F),t.Y36(I.uw),t.Y36(H._W),t.Y36(t.sBO),t.Y36(v.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-massupload"]],viewQuery:function(e,n){if(1&e&&t.Gf(x.NW,5),2&e){let s;t.iGM(s=t.CRH())&&(n.paginator=s.first)}},decls:26,vars:8,consts:[[1,"container","text-center"],["mat-card-avatar",""],[1,"material-icons"],[2,"margin-top","30px"],[1,"row","text-center"],[1,"row"],[1,"col-6"],["accept","text/csv",1,"main-dropzone",3,"multiple","disabled","change"],[4,"ngIf"],[1,"col"],["class","container text-center",4,"ngIf"],["class","row",4,"ngIf"],["mat-raised-button","","color","primary",2,"height","50px",3,"disabled","click"],["mat-raised-button","","color","warn",2,"height","50px",3,"click"],["mode","query",4,"ngIf"],[2,"overflow-x","auto"],["mat-table","","matSort","",3,"dataSource","matSortChange"],["table",""],["class","columns",3,"matColumnDef","sticky",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of imported results",3,"length","pageSize","pageSizeOptions"],["mode","query"],[1,"columns",3,"matColumnDef","sticky"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],[1,"adv"],[1,"col","text-center"],["mat-raised-button","",1,"ok",2,"width","170px","height","55px",3,"disabled","click"],[1,"text-center"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"div",1)(4,"span",2),t._uU(5," house "),t.qZA()(),t.TgZ(6,"mat-card-title"),t._uU(7,"OTM MassLoad"),t.qZA()(),t._UZ(8,"mat-divider"),t.TgZ(9,"mat-card-content",3)(10,"div",4)(11,"div",5)(12,"div",6)(13,"ngx-dropzone",7),t.NdJ("change",function(d){return n.onSelect(d)}),t.YNc(14,z,3,0,"div",8),t.YNc(15,Q,3,1,"div",8),t.qZA()(),t.TgZ(16,"div",9),t.YNc(17,Y,5,1,"div",8),t.qZA(),t.TgZ(18,"div",9),t.YNc(19,w,5,0,"div",8),t.qZA()(),t._UZ(20,"br")(21,"br"),t.qZA()()()(),t._UZ(22,"br"),t.YNc(23,q,16,10,"div",10),t._UZ(24,"br"),t.YNc(25,tt,17,2,"div",11)),2&e&&(t.xp6(13),t.Q6J("multiple",!1)("disabled",n.file.length>0),t.xp6(1),t.Q6J("ngIf",0==n.file.length),t.xp6(1),t.Q6J("ngIf",n.file.length>0),t.xp6(2),t.Q6J("ngIf",n.file.length>0),t.xp6(2),t.Q6J("ngIf",n.file.length>0),t.xp6(4),t.Q6J("ngIf",n.ELEMENT_DATA.length>0),t.xp6(2),t.Q6J("ngIf",n.ELEMENT_DATA.length>0))},directives:[c.a8,c.dk,c.kc,c.n5,M.d,c.dn,A._f,h.O5,A.NP,D.lW,E.pW,i.BZ,S.YE,h.sg,i.w1,i.fO,i.ge,i.Dz,i.ev,i.as,i.XQ,i.nj,i.Gk,i.Ee,x.NW,c.rt],styles:[".main-dropzone[_ngcontent-%COMP%]{padding:0 50px;height:50px;background:#dfdfdf;color:#4963f5;border:3px dashed #4963f5;border-radius:5px;font-size:20px}.ok.mat-raised-button[_ngcontent-%COMP%]{background-color:#7bff00b6;min-width:auto}.adv.mat-card[_ngcontent-%COMP%]{background-color:#f4f775b6}table[_ngcontent-%COMP%]{width:100%;overflow-y:scroll}.mat-cell[_ngcontent-%COMP%]{align-self:center;padding:5px;text-align:center;font-size:10px;height:10px;width:200px}.mat-column-ORDER_RELEASE_GID[_ngcontent-%COMP%]{border-right:1px solid #d1d1d1;padding-left:24px;padding-right:24px;text-align:center}.td.mat-cell[_ngcontent-%COMP%], .th.mat-cell[_ngcontent-%COMP%]{padding-left:24px;text-align:center}.mat-header-cell[_ngcontent-%COMP%]{background-color:#4682b4;color:#f5f5f5;text-align:center;min-width:200px;min-height:10px;font-size:12px}  .mat-form-field-appearance-outline .mat-form-field-outline{color:#fff;width:70px}input.mat-input-element[_ngcontent-%COMP%]{color:#000}"]}),o})()}];let ot=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[v.Bz.forChild(et)],v.Bz]}),o})();var at=a(1079),nt=a(1125),rt=a(3954),st=a(5245),lt=a(7531),it=a(9814),dt=a(4107),ct=a(3251),pt=a(7238),mt=a(7621),gt=a(3087),ut=a(2490),ft=a(6548),ht=a(8562),vt=a(5347);let Tt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[h.ez,ot,c.QW,D.ot,dt.LD,M.t,T.UX,A.bB,lt.c,I.Is,E.Cv,i.p0,ct.Nh,it.Fk,rt.N6,gt.YV,at.Bb,mt.IJ,ut.xC,ht.g3,ft.Z,vt.SharedModule,pt.AV,nt.To,st.Ps,x.TU,S.JX]]}),o})()}}]);